namespace = callback_ping

callback_ping.1 = {
	type = country_event
	hidden = yes

	trigger = {
		has_modifier = modifier_callback_ping
		total_population <= 10000000
	}

	immediate = {
		#Set-up
		ordered_country = {
			limit = {
				country_can_have_mass_migration_to = root
				any_scope_culture = {
					OR = {
						shares_language_trait_with_any_primary_culture = root
						shares_heritage_trait_with_any_primary_culture = root
					}
				}
			}
			order_by = global_population
			position = 0
			save_scope_as = mass_migration_source_country
			random_scope_culture = {
				limit = {
					OR = {
						shares_language_trait_with_any_primary_culture = root
						shares_heritage_trait_with_any_primary_culture = root
					}
				}
				save_scope_as = mass_migration_source_culture
			}
		}
		ordered_scope_state = {
			limit = {
				state_is_eligible_as_mass_migration_target = yes
				has_decree = decree_greener_grass_campaign
			}
			order_by = state_population
			position = 999
			save_scope_as = mass_migration_target_state
		}

		# Conditioned Execution
		if = {
			limit = {
				exists = scope:mass_migration_source_country
				exists = scope:mass_migration_source_culture
				exists = scope:mass_migration_target_state
			}
			scope:mass_migration_target_state = {
				create_mass_migration = {
					origin = scope:mass_migration_source_country
					culture = scope:mass_migration_source_culture
				}
			}
		}
	}
}

callback_ping.2 = {
	type = country_event
	hidden = yes

	trigger = {
		has_modifier = modifier_callback_ping
		OR = {
			total_population > 10000000
			has_law_or_variant = law_type:law_closed_borders
		}
	}

	immediate = {
		remove_modifier = modifier_callback_ping
	}
}
