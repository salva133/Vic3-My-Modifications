namespace = welfare_state

# Raises migration attraction and lowers approval of IGs
# who oppose social welfare or open borders
welfare_state.1 = {
	type = country_event
	placement = root

	title = welfare_state.1.tt
	desc = welfare_state.1.dd
	flavor = welfare_state.1.ff

	duration = 3

	cooldown = {
		months = 50
	}

	icon = gfx/interface/icons/timed_modifier_icons/modifier_fist_black.dds

	event_image = {
		video = "southamerica_slaves_night"
	}

	trigger = {
		NOT = { has_modifier = modifier_attractive_welfare_state }
		# Old Age Pensions and maxed out Institution
		has_law = law_type:law_old_age_pension
		institution_investment_level = {
			institution = institution_social_security
			value = 5
		}
		# Worker Protection and maxed out Institution
		has_law = law_type:law_worker_protections
		institution_investment_level = {
			institution = institution_workplace_safety
			value = 5
		}
		# At least one IG does not have the modifiers
		# and is either anti-welfare or anti-open-borders
		any_interest_group = {
			OR = {
				AND = {
					law_stance = {
						law = law_type:law_old_age_pension
						value < neutral
					}
					law_stance = {
						law = law_type:law_worker_protections
						value < neutral
					}
				}
				law_stance = {
					law = law_type:law_no_migration_controls
					value < neutral
				}
			}
			NOT = { has_modifier = modifier_unwanted_immigration }
		}
	}

	immediate = {
		every_interest_group = {
			limit = {
				OR = {
					AND = {
						law_stance = {
							law = law_type:law_old_age_pension
							value < neutral
						}
						law_stance = {
							law = law_type:law_worker_protections
							value < neutral
						}
					}
					law_stance = {
						law = law_type:law_no_migration_controls
						value < neutral
					}
				}
			}
			save_scope_as = regressive_igs
		}
		every_interest_group = {
			limit = {
				OR = {
					law_stance = {
						law = law_type:law_multicultural
						value > neutral
					}
					law_stance = {
						law = law_type:law_no_migration_controls
						value > neutral
					}
				}
			}
			save_scope_as = progressive_igs
		}
		every_scope_state = {
			limit = {
				is_incorporated = yes
				primary_cultures_percent_state > 0.5
			}
			save_scope_as = primary_culture_states
		}
		every_scope_state = {
			limit = {
				is_incorporated = yes
				primary_cultures_percent_state < 0.5
			}
			save_scope_as = foreigner_dominated_states
		}
	}

	option = {
		name = welfare_state.1.a
		default_option = yes

		every_scope_state = {
			limit = {
				is_incorporated = yes
				NOT = { has_modifier = modifier_attractive_welfare_state }
			}
			add_modifier = {
				name = modifier_attractive_welfare_state
				months = 25
			}
		}

		scope:regressive_igs = {
			if = {
				limit = { NOT = { has_modifier = modifier_unwanted_immigration } }
				add_modifier = {
					name = modifier_unwanted_immigration
					months = 25
				}
			}
		}
	}

	option = {
		name = welfare_state.1.b

		scope:primary_culture_states = {
			if = {
				limit = { NOT = { has_modifier = modifier_protective_government } }
				add_modifier = {
					name = modifier_protective_government
					months = 25
				}
			}
		}
		scope:progressive_igs = {
			if = {
				limit = { NOT = { has_modifier = modifier_disliking_xenophobia } }
				add_modifier = {
					name = modifier_disliking_xenophobia
					months = 25
				}
			}
		}
	}
}
